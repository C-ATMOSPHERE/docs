# AniLibria API – v2.8.3

- [**RestAPI**](#restapi) – *Документация по RestAPI*
- [**WebSocket**](#websocket) – *Документация по WebSocket*

## Rest API
```
http(s)://api.anilibria.tv/v2/
```

# Список методов:

- [**getTitle**](#gettitle) – *Получить информацию о тайтле*
- [**getTitles**](#gettitles) – *Получить информацию о нескольких тайтлах сразу*
- [**getUpdates**](#getupdates) – *Список тайтлов отсортированный по времени добавления нового релиза*
- [**getChanges**](#getchanges) – *Список тайтлов отсортированный по времени изменения*
- [**getSchedule**](#getschedule) – *Расписание выхода тайтлов, отсортированное по дням недели*
- [**getRandomTitle**](#getrandomtitle) – *Возвращает случайный тайтл из базы*
- [**getYouTube**](#getyoutube) – *Информация о вышедших роликах на наших YouTube каналах в хронологическом порядке*
- [**getFeed**](#getfeed) – *Список обновлений тайтлов и роликов на наших YouTube каналах в хронологическом порядке*
- [**getYears**](#getyears) – *Возвращает список годов выхода доступных тайтлов по возрастанию*
- [**getGenres**](#getgenres) – *Возвращает список жанров доступных тайтлов по алфавиту*
- [**getCachingNodes**](#getcachingnodes) – *Список кеш серверов с которых можно брать данные*
- [**getTeam**](#getteam) – *Возвращает список участников команды когда либо существовавших на проекте.*
- [**getSeedStats**](#getseedstats) – *Возвращает список пользователей и их статистику на трекере.*
- [**searchTitles**](#searchtitles) – *Возвращает список найденых по фильтрам тайтлов*

https://api.anilibria.tv/v2/getSeedStats?sort_by=user&order=1

# Описание методов: 

## • getTitle
Получить информацию о тайтле по id или коду 
```js
GET /v2/getTitle
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
id | int | ID тайтла |
code | string | Код тайтла |
filter | string, ... | Список значений которые будут в ответе |
remove | string, ... | Список значений которые будут удалены из ответа |
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*



### Примеры запросов
```js
/v2/getTitle?id=8500&filter=poster,type,status,player.playlist.24
```
```js
/v2/getTitle?code=nanatsu-no-taizai-kamigami-no-gekirin
```

### Пример ответа
```json
{
    "id": 8500,
    "code": "nanatsu-no-taizai-kamigami-no-gekirin",
    "names": {
        "ru": "Семь смертных грехов: Гнев богов",
        "en": "Nanatsu no Taizai: Kamigami no Gekirin",
        "alternative": null
    },
    "announce": "В 24 серии замена войсера. В течение недели будет исправление.",
    "status": {
        "string": "Завершен",
        "code": 2
    },
	"poster": {
        "url": "/upload/release/350x500/8500.jpg",
        "updated_timestamp": 1570770775,
        "raw_base64_file": null
	},
    "updated": 1585249972,
    "last_change": 1590523671,
    "type": {
        "full_string": "ТВ (24 эп.), 25 мин.",
        "code": 1,
        "string": "ТВ",
        "series": 24,
        "length": "25 мин"
    },
    "genres": [
        "экшен",
        "приключения",
        "сёнен",
        "сверхъестественное",
        "магия"
    ],
    "team": {
        "voice": [
            "Kari",
            "Anzen",
            "Sharon",
            "Cleo-chan",
            "Hekomi"
        ],
        "translator": [
            "Anku"
        ],
        "editing": [
            "mutagenb"
        ],
        "decor": [],
        "timing": [
            "Alkhorus"
        ]
    },
    "season": {
        "season_string": "осень",
        "season_code": 4,
        "year": 2019,
        "week_day": 5
    },
    "description": "Продолжение аниме «Семь смертных грехов» расскажет нам о том, как Грехи продолжают противостояние с Десятью Заповедями. Мелиодасу и Элизабет предстоит вновь испытать свою судьбу в новых приключениях и сражениях, а также открыть секрет этого мира.\nАнонсирован 4 сезон на октябрь 2020",
    "in_favorites": 9648,
    "blocked": {
        "blocked": false,
        "bakanim": false
    },
    "player": {
        "alternative_player": "//kodik.info/serial/19248/803944eb832adacd4d4bec7d4221f941/720p?translations=false",
        "hosts": {
            "mp4": "de8.libria.fun",
            "hls": "de4.libria.fun"
        },
        "series": {
            "first": 1,
            "last": 24,
            "string": "1-24"
        },
        "playlist": {
            "1": {
                "id": 1,
                "hls": {
                    "fhd": "/videos/ts/8500/0001-hd/playlist.m3u8",
                    "hd": "/videos/ts/8500/0001/playlist.m3u8",
                    "sd": "/videos/ts/8500/0001-sd/playlist.m3u8"
                },
                "mp4": {
                    "hd": "/get/Msnjux-QWNEyj3rOZDKzvw/1591296559/mp4/8500/0001.mp4",
                    "sd": "/get/wCFiBGhezOC3pbLOXP9NJw/1591296559/mp4/8500/0001-sd.mp4",
                    "download": {
                        "hd": "?download=Nanatsu_no_Taizai__Kamigami_no_Gekirin-hd.mp4",
                        "sd": "?download=Nanatsu_no_Taizai__Kamigami_no_Gekirin-sd.mp4"
                    }
                }
            },
            ...
        }
    },
    "torrents": {
		"series": {
            "first": 1,
            "last": 24,
            "string": "1-24"
        },
		"list": [
            {
                "torrent_id": 10725,
                "leechers": 2,
                "seeders": 16,
                "downloads": 8918,
                "quality": "WEBRip 1080p",
				"hevc": false,
                "series": {
                    "first": 1,
                    "last": 24,
                    "string": "1-24"
                },
                "total_size": 35521275317,
                "url": "/upload/torrents/10725.torrent",
                "uploaded_timestamp": 1590483840,
				"raw_base64_file": null,
                "metadata": {
                    "hash": "e45884bf43636bf61512a6c5eb1b7b9b0e84a925",
                    "name": "Nanatsu no Taizai - Kamigami no Gekirin - AniLibria.TV [WEBRip 1080p]",
                    "announce": [
                        "http://tr.libria.fun:2710/announce"
                    ],
                    "created_timestamp": 1590483891,
                    "files_list": [
                        {
                            "file": "Nanatsu_no_Taizai_Kamigami_no_Gekirin_[10]_[AniLibria_TV]_[WEBRip_1080p].mkv",
                            "size": 1036384565,
                            "offset": 0
                        },
                        {
                            "file": "Nanatsu_no_Taizai_Kamigami_no_Gekirin_[21]_[AniLibria_TV]_[WEBRip_1080p].mkv",
                            "size": 1372075412,
                            "offset": 1036384565
                        },
                        ...
                    ]
                }
            },
			...
		]
	}
}
```
***

## • getTitles
Получить информацию о тайтле по id или коду 
```js
GET /v2/getTitles
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
id_list | string, ... | Список ID тайтлов |
code_list | string, ... | Список кодов тайтла |
filter | string, ... | Список значений которые будут в ответе |
remove | string, ... | Список значений которые будут удалены из ответа |
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*



### Примеры запросов
```js
/v2/getTitles?id_list=8500,8644&filter=poster,type,status,player.playlist.24
```
```js
/v2/getTitles?code_list=nanatsu-no-taizai-kamigami-no-gekirin
```

### Пример ответа
```json
[
	[Возвращаемые поля идентичны /getTitle],
	...
]
```
***


## • getUpdates
Получить список последних обновлений тайтлов

```js
GET /v2/getUpdates
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
limit | int | Количество объектов в ответе | 5
since | int | Список тайтлов у которых время обновления больше указанного timestamp | 
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/api/v2/getUpdates?filter=poster,type,status&limit=5
```
```js
/api/v2/getUpdates?since=1590233417
```
### Пример ответа

```json
[
	[Возвращаемые поля идентичны /getTitle],
	...
]
```
***

## • getChanges
Получить список последних обновлений тайтлов

```js
GET /v2/getChanges
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
limit | int | Количество объектов в ответе | 5
since | int | Список тайтлов у которых время обновления больше указанного timestamp | 
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getChanges?filter=poster,type,status&limit=5
```
```js
/v2/getChanges?since=1590233417
```
### Пример ответа

```json
[
	[Возвращаемые поля идентичны /getTitle],
	...
]
```
***


## • getSchedule
Получить список последних обновлений тайтлов

```js
GET /v2/getSchedule
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | --  | -- 
filter | string, ... | Список значений которые будут в ответе
remove | string, ... | Список значений которые будут удалены из ответа
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
days | string, ...  | Список дней недели на которые нужно расписание
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

> Счет дней недели идет с понедельника, где 0 - Понедельник, а 6 - Воскресенье.

### Примеры запросов
```js
/v2/getSchedule?filter=poster,type,status
```
```js
/v2/getSchedule?days=5,6
```
### Пример ответа

```json
[
	{
		"day": 5,
		"list": [
			[Возвращаемые поля идентичны /getTitle],
			...
		]
	},{
		"day": 6,
		"list": [
			[Возвращаемые поля идентичны /getTitle],
			...
		]
	}
]
```
***


## • getCachingNodes
Список кеш серверов с которых можно брать данные

```js
GET /v2/getCachingNodes
```

### Примеры запросов
```js
/v2/getCachingNodes
```
### Пример ответа

```json
{
    "de4": 10,
    "de6": 10,
    "de1": 10,
    "de3": 10,
    "de10": 10,
    "de2": 10,
    "static": 5
}
```
***


## • getRandomTitle
Возвращает случайный тайтл из базы

```js
GET /v2/getRandomTitle
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | --  | -- 
filter | string, ... | Список значений которые будут в ответе
remove | string, ... | Список значений которые будут удалены из ответа
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getRandomTitle
```
### Пример ответа

```json
{
    [Возвращаемые поля идентичны /getTitle],
}
```
***


## • getYouTube
Информация о вышедших роликах на наших YouTube каналах в хронологическом порядке

```js
GET /v2/getYouTube
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
limit | int | Количество объектов в ответе | 5
since | int | Список видеороликов у которых время обновления больше указанного timestamp | 
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getYouTube?limit=10
```
### Пример ответа

```json
[
    {
        "id": 341,
        "title": "АНОНС - АНИМЕ ЗИМА 2017",
        "image": "https://img.youtube.com/vi/OXBO4h3l3rM/0.jpg",
        "youtube_id": "OXBO4h3l3rM",
        "timestamp": 1503824801
    },
	...
}
```
***


## • getFeed
Список обновлений тайтлов и роликов на наших YouTube каналах в хронологическом порядке

```js
GET /v2/getFeed?filter=
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
limit | int | Количество объектов в ответе | 5
since | int | Список тайтлов у которых время обновления больше указанного timestamp | 
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object
after | int | Удаляет первые n записей из выдачи  | 

*В параметрах `filter` и `remove` можно указать полный путь до ключа который вы хотите оставить или удалить, например `names.alternative` или `team.voice[0]`, с версии 2.8. появилась возможность получать значения одного ключа во всех объектах в массиве, например: torrents.list[\*].torrent_id*

### Примеры запросов
```js
/v2/getFeed?limit=10
```
### Пример ответа

```json
[	
	{
		"youtube": {
			[Возвращаемые поля идентичны /getYouTube]
		}
	},
	{
		"youtube": {
			[Возвращаемые поля идентичны /getYouTube]
		}
	},
	{
	    "title": {
			[Возвращаемые поля идентичны /getTitle]
		}
	},
	...
]
```
***


## • getYears
Возвращает список годов выхода доступных тайтлов отсортированный по возрастанию

```js
GET /v2/getYears
```

### Примеры запросов
```js
/v2/getYears
```
### Пример ответа

```json
[
    1996,
    1998,
    2001,
    2003,
   ...
]
```
***


## • getGenres
Возвращает список жанров доступных тайтлов отсортированный по алфавиту

```js
GET /v2/getGenres
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
sorting_type | int | Тип сортировки элементов | 0
 | | `0 - Сортировка по алфавиту` |
 | | `1 - Сортировка по рейтингу` |

### Примеры запросов
```js
/v2/getGenres
```
### Пример ответа

```json
[
    "боевые искусства",
    "вампиры",
    "демоны",
	...
]
```
***


## • searchTitles
Возвращает список найденных по фильтрам тайтлов

```js
GET /v2/searchTitles
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
search | string, ... | Поиск по именам и описанию |
year | string, ... | Список годов выхода | 
season_code | string, ... | Список сезонов, [подробнее](#season) | 
genres | string, ... | Список жанров | 
voice | string, ... | Список войсеров через запятую | 
translator | string, ... | Список перводчиков | 
editing | string, ... | Список сабберов | 
decor | string, ... | Список оформителей | 
timing | string, ... | Список таймеров | 
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
include | string, ... | Список типов файлов которые будут возвращены в виде base64 строки [подробнее](#include) |
description_type | string | Тип получаемого описания, [подробнее](#description_type) | plain
playlist_type | string | Формат получаемого списка серий, `object` или `array` | object
limit | int | Количество объектов в ответе | 5
after | int | Удаляет первые n записей из выдачи  | 

### Примеры запросов
```js
/v2/searchTitles?search=cудьба апокреф&voice=Amikiri,Silv,Hekomi&filter=id,names,team,genres[0]&limit=10
```
> Поиск идет по неточному совпадению, так что опечатки допустимы.

### Пример ответа

```json
{
    [Возвращаемые поля идентичны /getTitle]
}
```
***


## • getTeam
Возвращает список участников команды когда либо существовавших на проекте.

```js
GET /v2/getTeam
```

### Примеры запросов
```js
/v2/getTeam
```

### Пример ответа

```json
{
    "team": {
            "voice": [...],
            "translator": [...],
            "editing": [...],
            "decor": [...],
            "timing": [...]
     }
}
```


## • getSeedStats
Возвращает список участников команды когда либо существовавших на проекте.

```js
GET /v2/getSeedStats
```

### Все доступные параметры
Параметр | Тип | Описание | По умолчанию
-- | -- | -- | --
users | string, ... | Стистиктика по имени пользователя |
filter | string, ... | Список значений которые будут в ответе | 
remove | string, ... | Список значений которые будут удалены из ответа | 
limit | int | Количество объектов в ответе | 5
after | int | Удаляет первые n записей из выдачи  | 
sort_by | string | По какому полю производить сортировку, допустимые значения: downloaded, uploaded, user  | 
order | int | Направление сортировки 0 - DESC, 1 - ASC  | 

### Примеры запросов
```js
/v2/getSeedStats?users=T1MOX4
```

### Пример ответа

```json
[
    {
        "downloaded": 72110162198,
        "uploaded": 1163165762554,
        "user": "T1MOX4"
    }
]
```


### Возвращаемые значения при запросе информации о тайтле
id **int**  – ID тайтла
code **string** – Код тайтла, используется для создания ссылки
[names](#names): **object** – Названия тайтла.
[poster](#poster) **object** – Информация о постере
updated **int** – Timestamp последнего обновления тайтла (обычно тайтл обновляют при выходе новых релизов)
last_change **int** – Timestamp последнего изменения тайтла (Например описания, или анонса)
[status](#status) **object** – Статус тайтла
[type](#type) **object** – Типа тайтла
genres **array[string]** – Список жанров
[team](#team) **object** – Ники членов команды работавших над тайтлом
[season](#season) **object** – Сезон, год выхода, и день недели из расписания когда выходят новые серии
year **int** – Год выпуска тайтла
week_day **int** – День недели, когда выходят новые релизы
description **string** – Описание тайтла в указанном в [description_type](#description_type) формате
[blocked](#blocked) **object** – Информация о блокировках тайтла
[player](#player) **object** – Информация о сериях в плеере
[torrents](#torrents) **object** – Информация о торрент файлах

### Возвращаемые значения при запросе информации о youtube ролике
id **int**  – ID записи в базе
title **string** – Название видео ролика
image **string** – Ссылка на превью к ролику
youtube_id **string** – ID видео на YouTube (Легко форматируется в https://youtu.be/{youtube_id})
timestamp **int** – Timestamp времени добавления в базу


>*В случае отсутствия какой-то информации значения поля будет `null` для строк, пустой массив для массивов, и 0 для чисел*
>*Такое редко, но бывает.*



#### names:
> ru **string** – Русское название тайтла
> en **string** – Английское название тайтла
> alternative **string** – Альтернативное название

#### poster:
> url **string** – Относительный url на постер
> updated_timestamp **int** – Timestamp изменения файла на сервере
> raw_base64_file **string** – Постер в base64 формате (если запрошен в параметре [include](#include))

#### series:
> string **string** – Количество серий в виде строки
> first **int** – Первая серия
> last **int** – Последняя серия

#### status:
> string **string** – Статус тайтла в виде строки
> code **int** – Статус тайтла в виде числа
>> 1 – В работе
>> 2 – Завершен
>> 3 – Скрыт
>> 4 – Неонгоинг

#### type:
> full_string **string** – Тип тайтла целиком в виде строки (как это указано на сайте)
> string **string** – Тип тайтла в виде строки
> series **int** – Ожидаемое количество серий
> length **string** – Длительность серий
> code **int** – Тип тайтла в виде числа 
>> 0 – Фильм
>> 1 – TV
>> 2 – OVA
>> 3 – ONA
>> 4 – Спешл

#### team:
> voice **array[string]** – Список войсеров работавших над озвучкой
> translator **array[string]** – Список участников команды работавших над переводом
> editing **array[string]** – Список участников команды работавших над субтитрами
> decor **array[string]** – Список участников команды работавших над оформлением
> timing **array[string]** – Список участников команды работавших над таймингом

#### season:
> year **int** – Список войсеров работавших над озвучкой
> week_day **int** – Список участников команды работавших над оформлением
> > Счет дней недели идет с понедельника, где 0 - Понедельник, а 6 - Воскресенье.
> season_string **string** – Название сезона в котором вышел тайтл.
> season_code **int** – Код сезона в котором вышел тайтл.
> > Возможные значения:
> > 1 - Зима, 2 - Весна, 3 - Лето, 4 - Осень

#### blocked:
> blocked **bool** – Тайтл заблокирован на территории РФ
> bakanim **bool** – Тайтл заблокирован из за жалобы Wakanim
***

#### player:
> alternative_player **string** – Ссылка на альтернативный плеер
> [hosts](#hosts) **object** – Имена предпочитаемых серверов для построения ссылок на поток и скачивание
> [playlist](#playlist) **object** – Список релизов тайтла со ссылками на просмотр и загрузку.
> [series](#series) **object** – Количество вышедших в плеере серий

##### hosts:
> mp4 **string** – Предпочитаемых хост для получения доступа к mp4 файлу
> hls **string** – Ссылка без домена на альтернативный плеер
Эти имена служат для того чтоб использовать их как часть ссылки к файлу.
Например `https://de8.libria.fun/get/sample/1590338560/mp4/8500/0001-sd.mp4?download=Nanatsu_no_Taizai__Kamigami_no_Gekirin-sd.mp4` позволит скачать указанный файл с сервера.

##### playlist:
> id **int** – Номер серии
> [hls](#hls) **object** – Объект содержащий ссылки на потоковое воспроизведение в разном качестве
> [mp4](#mp4) **object** – Объект содержащий прямые ссылки просмотр и скачивание в mp4 формате в разном качестве

###### hls:
> fhd **string** – Ссылка без домена на потоковое воспроизведение в Full-HD качестве
> hd **string** – Ссылка без домена на потоковое воспроизведение в HD качестве
> sd **string** – Ссылка без домена на потоковое воспроизведение в SD качестве

###### mp4:
> hd **string** – Ссылка без домена на воспроизведение в HD качестве
> sd **string** – Ссылка без домена на воспроизведение в SD качестве
> [download](#download) **object** – Объект содержащий ссылки на скачивание mp4 файлов

###### download:
> hd **string** – Часть ссылки на скачивание mp4 файла в HD качестве
> sd **string** – Часть ссылки на скачивание mp4 файла в SD качестве
*Важно знать что ссылки на скачивание mp4 временные и через некоторое время перестают работать.*
*И не стоит злоупотреблять загрузками, так как ресурсы серверов ограничены.*
***

#### torrents:
> [series](#series) **object** – Серии содержащиеся в файле
> list **array[object]** – Массив объектов с информацией о торрент файлах

##### list:
*Содержит массив объектов с информацией о торрент файлах.*
> torrent_id **int** – ID торрент файла
> [series](#series) **object** – Серии содержащиеся в файле
> [quality](#quality) **object** – Информации о разрешении, кодировщике и типе релиза
> leechers **int** – Количество личеров (личей)
> seeders **int** – Количество сидеров (сидов)
> downloads **int** – Количество загрузок файла
> total_size **int** – Размер файлов в торренте в байтах
> url **string** – Ссылка на торрент файл без домена
> uploaded_timestamp **int** – Время загрузки торрента в формате unix timestamp
> raw_base64_file **string** – Торрент файл в base64 формате (если запрошен в параметре [include](#include))
> [metadata](#metadata) **object** – Объект содержащий метаданные торрент файла

###### quality:
> string **string** – Полная строка с описание качества и типа релиза
> type **string** – Тип релиза WEBRip, HDRip и  тд...
> resolution **int** – Разрешение одной стороны изображения. Например 720
> encoder **string** – Строка указывающая на кодировщик используемый для кодирования релиза, h264 или h265
> lq_audio **bool** – Используется ли аудио дорожка с пониженным битрейтом (Для экономии размера файла)

###### metadata:
> hash **string** – Хеш торрент файла
> name **string** – Имя тайтла в торрент файле
> announce **array[string]** – Массив строк содержащий список трекеров
> created_timestamp **int** – Время создания/изменения торрента в формате unix timestamp
> [files_list](#files_list) **array[object]** – Массив объектов содержащий список файлов в торренте

###### files_list:
> file **string** – Имя файла
> size **int** – Размер файла в байтах
> offset **int** – Смещение в байтах относительно предыдущего файла


#### description_type:
> html – Описание тайтла в виде html (в том виде в каком оно на сайте)
> plain – Описание тайтла в виде текста без дополнительного форматирования
> no_view_order – Описание тайтла в виде текста без дополнительного форматирования и порядка просмотра

#### include:
*Это полезно в случае если вы не хотите делать много запросов, такая конструкция позволяет получить все необходимое в одном запросе*
> raw_poster – Добавить постер в base64 формате в ответ
> raw_torrent – Добавить торрент файлы в base64 формате в ответ
> torrent_meta - Добавить в ответ метаданные торрента (список файлов, их размер, трекер)

***



### Возможные коды ошибок
```json
{
	"error": { "code": 500, "message": "Internal Server Error!" }
}
```
Возникает в случае непредвиденной внетренней ошибки сервера.
> Все 5хх ошибки возвращают статус код 500, хотя в теле ответа будет указан настоящий код.
```json
{
	"error": { "code": 412, "message": "Unknown parameters: code, id" }
}
```
Возникает в случае если передать неизвестный параметр в запросе.
```json
{
	"error": { "code": 404, "message": "Title "test" not found!" }
}
```
Возникает в случае если запрошен тайтл которого нет в базе

и другие...

>В случае ошибки HTTP Status дублирует код из **error.code** (Исключение 5хх ошибки)
>В случае успешного выполнения запроса будет возвращен HTTP Status:  **200**
***

### Полезное
1. Версию API можно узнать в заголовке `API-Version` и сравнить ее с версией документации чтоб узнать актуальна ли документация.
2. Версии меняются по принципу <Major>.<Minor>.<Patch> где Major обозначает очень крупные изменения в коде проекта без обратной совместимости, Minor обозначает существенные изменения в API с частичной обратной совместимостью, и Patch исправление различных ошибок, не влияет на совместимость.
3. С версии 2.6.2. появилась поддержка старых версий api и был расширен функционал версионирования.
Таким образом теперь можно использовать либо последнюю версию с последними исправлениями, либо старую минорную со старой схемой которая не будет обновляться и меняться со временем.
Например сейчас можно использовать ссылки следующего формата:
>Ссылка на актуальную мажорную версию API - https://api.anilibria.tv/v2/...
>Ссылка на минорный патч со всеми исправлениями - https://api.anilibria.tv/v2.6/...
>Ссылка на текущий патч - https://api.anilibria.tv/v2.6.2/...


## WebSocket
```
ws(s)://api.anilibria.tv/v2/ws/
```

### При изменении информации о тайтле
При обновлении какой-либо информации о тайтле ВебСокет отправляет всем клиентам строку в формате:
```
{
	"hash": "c3499c2729730a7f807efb8676a92dcb6f8a3f8f"
    "title": {
		[Возвращаемые поля идентичны /getTitle]
	}
}
```

#### Возвращаемые значения
hash **string**  – Хеш уведомления (желательно сравнивать его с предыдущим так как возможны дублирующиеся уведомления)
title **object** – Объект содержащий все поля из /getTitle

### При обновлении списка релизов в плеере
При обновлении плейлиста тайтла, что происходит при добавлении или перезаливе релиза, ВебСокет отправляет всем клиентам строку в формате:
```
{
	"id": 8500,
	"serie": 1,
    "playlist": {
        "1": {
            "id": 1,
            "hls": {
                "fhd": "/videos/ts/8500/0001-hd/playlist.m3u8",
                "hd": "/videos/ts/8500/0001/playlist.m3u8",
                "sd": "/videos/ts/8500/0001-sd/playlist.m3u8"
            },
            "mp4": {
                "hd": "/get/Msnjux-QWNEyj3rOZDKzvw/1591296559/mp4/8500/0001.mp4",
                "sd": "/get/wCFiBGhezOC3pbLOXP9NJw/1591296559/mp4/8500/0001-sd.mp4",
                "download": {
                    "hd": "?download=Nanatsu_no_Taizai__Kamigami_no_Gekirin-hd.mp4",
                    "sd": "?download=Nanatsu_no_Taizai__Kamigami_no_Gekirin-sd.mp4"
                }
            }
        },
        ...
    }
}
```

#### Возвращаемые значения
id **int**  – ID обновленного тайтла
serie **int**  – Номер вышедшего или перезалитого релиза
playlist **object** – Объект содержащий все плейлист аналогичный /getTitle

> Раз в 30 секунд отправляется Ping пакет который проверяет соединение.
***

### Подписка на определенные уведомления.
Для подписки нужно отправить по вебсокету команду в json формате со следующим содержанием:
```{
	"subscribe": {
		"season": {
			"year": 2020
		}
		//Тут могут быть любые поля и значения которые отправляет вебсокет. После добавления подписки вебсокет будет отправлять только те поля которые соответствуют заданым фильтрам. Можно отправить несколько фильтров, тогда бот будет отправлять уведомление при совпадении с одним из них.
	}
}
```

# ToDo
- [ ] Добавить поддержку авторизации
- [ ] Добавить доступ к API по ключу без необходимости использовать логин и пароль, и хранить куки